flowchart TB
    %% Client Layer
    Client[Mobile App Client]
    
    %% API Gateway Layer
    subgraph API[API Layer]
        REST[REST API Endpoints]
        WS[WebSocket Server]
        Auth[Authentication Middleware]
    end
    
    %% Service Layer
    subgraph Services[Service Layer]
        UserService[User Service]
        LocationService[Location Service]
        PlaceService[Place Service]
        ChatService[Chat Service]
        NotificationService[Notification Service]
        SearchService[Search Service]
    end
    
    %% Integration Layer
    subgraph External[External Services]
        Firebase[Firebase]
        MapBox[MapBox API]
        CloudStorage[Cloud Storage]
        PushNotif[Push Notifications]
    end
    
    %% Database Layer
    subgraph DB[Database Layer]
        PostgreSQL[(PostgreSQL)]
        Redis[(Redis Cache)]
        FirebaseDB[(Firebase Realtime DB)]
    end
    
    %% Background Tasks
    subgraph Tasks[Background Tasks]
        Celery[Celery Workers]
        CacheUpdate[Cache Updates]
        DataCleanup[Data Cleanup]
    end
    
    %% Connections - Client to API
    Client --> REST
    Client --> WS
    REST & WS --> Auth
    
    %% API to Services
    Auth --> Services
    
    %% Service Layer Connections
    UserService --> Firebase
    LocationService --> MapBox
    PlaceService --> CloudStorage
    ChatService --> WS
    NotificationService --> PushNotif
    SearchService --> Redis
    
    %% Database Connections
    Services --> PostgreSQL
    Services --> Redis
    Services --> FirebaseDB
    
    %% Background Tasks Connections
    Celery --> Services
    CacheUpdate --> Redis
    DataCleanup --> PostgreSQL

    %% Color and Style Definitions
    classDef primary fill:#000080,stroke:#333,stroke-width:2px,color:white;
    classDef secondary fill:#4B0082,stroke:#333,stroke-width:2px,color:white;
    classDef database fill:#1E90FF,stroke:#333,stroke-width:2px,color:white;
    classDef external fill:#483D8B,stroke:#333,stroke-width:2px,color:white;
    
    %% Apply Styles
    class Client,API,Services primary;
    class Tasks,External secondary;
    class DB database;
    class Firebase,MapBox,CloudStorage,PushNotif external;